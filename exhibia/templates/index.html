{% extends 'site_base.html' %}
{% block body %}
	<div class="btn-group sorting" data-toggle="buttons-radio">
		<button class="btn btn-mini active" id="sort_by_name">All</button>
	  	<button class="btn btn-mini" id="sort_by_fund">Fund</button>
	  	<button class="btn btn-mini" id="sort_by_bid">Bid</button>
	</div>
    <div class="scroller">
        <div class="scrollingtext">Something something scrolling to the left</div>
    </div>
    <div id="items_container" class="row items">
        {% include 'auctions/auctions.html' %}
    </div>

    <div id="chat" class="tabbed">
		<h3 class="tab-title">Chat</h3>
		<div class="container">
			<ul class="unstyled chat-container"></ul>
			<div class="input-prepend type-message">
				<span class="add-on"><i class="icon-envelope"></i></span>
				<input id="chat-msg" type="text" class="span2" />
			</div>
		</div>
	</div>

{% endblock %}
{% block extra_js %}
    <script>
    $(document).ready(function() {
        socket = io.connect('/chat');
        socket.on('news', function (data) {
            //console.log(data);
            //socket.emit('my other event', { my: 'data' });
        });

		$('#chat .tab-title').click(function() {
			$('#chat .container').toggle();
		});

        socket.on('update', function(data){
            //  updates auctions running
            auctions = $.parseJSON(data['auctions']);
            $.exhibia['auctions'] = new Auctions(auctions);
            update_auctions_ui(auctions);
        });

        // User hits enter
        $('#chat-msg').keyup(function(e){
			var code = e.which;

			if(code==13) {
                socket.emit('send_chat_message', $(this).val());
				// send_message($(this).val());
				$(this).val('');
			}
		});

        socket.on('user_message', function(username, message, picture){
        	var chat_msg = $('<li />').addClass('row').hide();
        		chat_msg.html('<div class="span1"><img src="' + picture +'" class="img-circle" title="'+ username +'" /></div><div class="span2"><span class="user-name">' + username +'</span>' + message +'</div>');
           $('#chat .chat-container').prepend(chat_msg);
           		chat_msg.slideDown();
        });
    });
    </script>
{% endblock %}
