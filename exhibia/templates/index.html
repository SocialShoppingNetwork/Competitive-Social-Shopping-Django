{% extends 'site_base.html' %}
{% load compress %}
{% block body %}
	<div class="btn-group sorting" data-toggle="buttons-radio">
		<button class="btn btn-mini active" id="sort_by_name">All</button>
	  	<button class="btn btn-mini" id="sort_by_fund">Fund</button>
	  	<button class="btn btn-mini" id="sort_by_bid">Bid</button>
	</div>
    <div class="scroller">
        <div class="scrollingtext">Something something scrolling to the left</div>
    </div>
    <div id="items_container" class="row items">
        {% include 'auctions/auctions.html' %}
    </div>

    <div id="chat" class="tabbed">
        <div class="social-stream">
            <ul class="unstyled stream">
            </ul>
        </div>
        <div class="divisor"></div>
        <div class="video-stream">
        </div>
        <h3 class="tab-title">Chat</h3>
        <div class="container chat-content">
            <ul class="unstyled chat-container"></ul>
            <div class="input-prepend type-message">
                <span class="add-on"><i class="icon-envelope"></i></span>
                <input id="chat-msg" type="text" class="span2">
            </div>
        </div>
    </div>

{% endblock %}
{% block extra_js %}
    {% compress js %}
        <script type="text/javascript" src="{{ STATIC_URL }}js/socket.io.js"></script>
        <script type="text/javascript">$.exhibia = {};</script>
        <script type="text/javascript" src="{{ STATIC_URL }}js/winnina.js"></script>
        <script type="text/javascript" src="{{ STATIC_URL }}js/item.js"></script>
    {% endcompress %}
    <script>
    $(document).ready(function() {
        socket = io.connect('/chat');
        socket.on('news', function (data) {
            //console.log(data);
            //socket.emit('my other event', { my: 'data' });
        });

		$('#chat .tab-title').click(function() {
			$('#chat .container').toggle();
		});


        // User hits enter
        $('#chat-msg').keyup(function(e){
			var code = e.which;

			if(code==13) {
                socket.emit('send_chat_message', $(this).val());
				$(this).val('');
			}
		});

        var adaptSidebar = function() {
            // Chat is displayed as a sidebar
            var chat_height         = $('#chat').outerHeight();
            var video_stream_height = (!$('.video-stream').is(':visible')) ? 0 : $('.video-stream').height();
            var chat_content_height = $('.chat-content').outerHeight();
            var divisors            = $('#chat .divisor').length;
            var diff = (chat_height - (video_stream_height + chat_content_height + (8 * divisors)));
            $('.social-stream').css('height', diff - 70);
        }

        var body_width = $('body').outerWidth();
        if(body_width > 1000) {
            adaptSidebar();
        }

        $(window).on('resize', adaptSidebar);

        $('#chat .divisor').click(function() {
            $('.video-stream').toggle();
            $('.chat-content').toggleClass('no-video');
            adaptSidebar();
        });


        socket.on('user_message', function(username, message, picture){
        	var chat_msg = $('<li />').addClass('row').hide();
        		chat_msg.html('<div class="span1"><img src="' + picture +'" class="img-circle" title="'+ username +'" /></div><div class="span2"><span class="user-name">' + username +'</span>' + message +'</div>');
           $('#chat .chat-container').prepend(chat_msg);
           		chat_msg.slideDown();
        });
    });
    </script>
{% endblock %}
